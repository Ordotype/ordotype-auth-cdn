(function(c){typeof define=="function"&&define.amd?define(c):c()})(function(){"use strict";var N=Object.defineProperty;var q=(c,w,h)=>w in c?N(c,w,{enumerable:!0,configurable:!0,writable:!0,value:h}):c[w]=h;var S=(c,w,h)=>q(c,typeof w!="symbol"?w+"":w,h);const c={LOGOUT:"memberstack.logout",GET_APP:"memberstack.getApp",LOGIN:"memberstack.login",VALID_SESSION:"memberstack.validSession",SIGN_UP:"memberstack.signUp"};function w(a){if(!a)throw new Error("Memberstack instance is not defined");window._msConfig||(window._msConfig={preventLogin:!0}),window.$memberstackDom=new Proxy(a,{get(e,t){const o=e[t];return typeof o=="function"?async function(...i){if(console.log(`Method ${t} called with arguments: ${JSON.stringify(i)}`),t==="logout"){const r=new CustomEvent(c.LOGOUT,{bubbles:!1,cancelable:!1,detail:i[0]});return document.dispatchEvent(r),!1}if(t==="getApp"){const r=new Event(c.GET_APP,{bubbles:!1,cancelable:!1});document.dispatchEvent(r)}if(t==="loginMemberEmailPassword"){const r=new CustomEvent(c.LOGIN,{bubbles:!1,cancelable:!1,detail:i[0]});return document.dispatchEvent(r),{data:{}}}if(t==="loginWithProvider"){const r=await o.apply(e,i),d=new CustomEvent(c.LOGIN,{bubbles:!1,cancelable:!1,detail:r});return document.dispatchEvent(d),r}if(t==="signupWithProvider"){const r=await o.apply(e,i),d=new CustomEvent(c.SIGN_UP,{bubbles:!1,cancelable:!1,detail:r});return document.dispatchEvent(d),r}if(t==="signupMemberEmailPassword"){const r=await o.apply(e,i),d=new CustomEvent(c.SIGN_UP,{bubbles:!1,cancelable:!1,detail:r});return document.dispatchEvent(d),r}return o.apply(e,i)}:o}})}function h(){const a="_ga_7T2LX34911",e=document.cookie.split("; ");for(const t of e){const[o,i]=t.split("=");if(o===a)return i}throw new Error("Device Id cookie not found")}const A="https://staging-api.ordotype.fr/v1.0.0";class b extends Error{constructor(t,o=500){super(t);S(this,"status");this.name="AuthError",this.status=o,Error.captureStackTrace&&Error.captureStackTrace(this,b)}}class y extends Error{constructor(t,o,i){super(t);S(this,"data");S(this,"type");this.name="TwoFactorRequiredError",this.data=o,this.type=i}}class _{constructor(){S(this,"headers");const e="pk_sb_e80d8429a51c2ceb0530",t=window.localStorage.getItem("ms_session_id"),o=h();this.headers={"X-Api-Key":e,"X-Session-Id":t??void 0,"X-Device-Id":o??void 0}}async request(e,t,o="GET",i=null,r={}){const d=`${A}/${t}/${e}`,E={"Content-Type":"application/json",...this.headers,...r},k={method:o,headers:E,...i&&{body:JSON.stringify(i)}};try{const u=await fetch(d,k);if(!u.ok)throw new b(u.statusText,u.status);return u.status===204||!u.body?null:await u.json()}catch(u){throw console.error("API Request Failed:",u),u}}async validateSessionStatus(){try{const e=localStorage.getItem("_ms-mid");return await this.request("validate-session-status","auth","POST",null,{Authorization:`Bearer ${e}`})}catch(e){throw console.error("Session validation failed:",e),e}}async logout(){try{const e=localStorage.getItem("_ms-mid");await this.request("logout","auth","POST",null,{Authorization:`Bearer ${e}`}),localStorage.removeItem("_ms-mid")}catch(e){throw console.error("Session logout failed:",e),e}}async signup(e){const t={...e,device:this.headers["X-Device-Id"]??"unknown"};return await this.request("signup","auth","POST",t,{})}async login(e){const t={...e,options:{includeContentGroups:!0,isWebflow:!0},device:this.headers["X-Device-Id"]??"unknown"},o=await this.request("login","auth","POST",t,{});if(D(o))throw new y("2fa required",o.data,o.type);return o}async loginWithProvider(e){const t={...e,device:this.headers["X-Device-Id"]??"unknown"},o=await this.request("validate-google-provider","auth","POST",t,{});if(D(o))throw new y("2fa required",o.data,o.type);return o}getCookie(e){const t=document.cookie.match(new RegExp(`(^| )${e}=([^;]+)`));return t?decodeURIComponent(t[2]):null}setCookie(e,t,o){const i=new Date;i.setTime(i.getTime()+o),document.cookie=`${e}=${encodeURIComponent(t)}; expires=${i.toUTCString()}; path=/`}async throttle(e,t,o){const i=this.getCookie(t),r=Date.now();if(i&&r-parseInt(i,10)<o)return console.log(`Skipping execution of ${t}: Throttled.`),null;console.log(`Executing ${t}...`);const d=await e();return this.setCookie(t,r.toString(),o),d}validateSessionStatusThrottled(){return localStorage.getItem("_ms-mid")?this.throttle(()=>this.validateSessionStatus(),"lastSessionValidation",3*60*1e3):Promise.resolve(null)}}function D(a){return"data"in a&&typeof a.data=="object"&&"type"in a}new _;function P(){return!!localStorage.getItem("_ms-mid")}function I(a){window.$memberstackDom._showLoader(),setTimeout(()=>{window.location.href=a},500)}const L=async(a,e="/")=>{await window.$memberstackDom.logout(),localStorage.removeItem("_ms-mid"),localStorage.removeItem("_ms_mem"),I(e)},T=a=>{const e=new CustomEvent(c.VALID_SESSION,{bubbles:!1,cancelable:!1,detail:{isStatusValid:a}});document.dispatchEvent(e)};function $(){var k,u;function a(s){return"provider"in s}function e(s){return"email"in s&&"password"in s}function t(s){const n={};return s.querySelectorAll("[data-ms-member]").forEach(m=>{const g=m.getAttribute("data-ms-member");g&&!["email","password","new-password","current-password"].includes(g)&&(n[g]=m.value||"")}),n}function o(s){const n=s.getAttribute("data-ms-plan")||s.getAttribute("data-ms-plan:add")||s.getAttribute("data-ms-plan:update"),l=s.getAttribute("data-ms-price:add");return{freePlan:n,paidPlan:l}}async function i(s,n){console.error(s,n),await window.$memberstackDom._showMessage((n==null?void 0:n.message)||"An error occurred",!0)}async function r(s,n){var f,p;s.preventDefault(),s.stopPropagation(),s.stopImmediatePropagation();const l=s.target,m=(f=l.querySelector('[data-ms-member="email"]'))==null?void 0:f.value,g=(p=l.querySelector('[data-ms-member="password"]'))==null?void 0:p.value;n==="signup"?await E(l,{email:m,password:g}):n==="login"&&await d(l,{email:m,password:g})}async function d(s,n){let l;if(a(n))l={provider:n.provider};else if(e(n))l={email:n.email,password:n.password};else throw new Error("Invalid form authentication options");try{const m=a(n)?await window.$memberstackDom.loginWithProvider(l):await window.$memberstackDom.loginMemberEmailPassword(l);console.log("Signin successful:",m)}catch(m){await i("Login failed:",m)}}async function E(s,n){const l=t(s),{freePlan:m,paidPlan:g}=o(s);let f={customFields:l};if(a(n))f={allowLogin:!1,provider:n.provider};else if(e(n))f={email:n.email,password:n.password};else throw new Error("Invalid form authentication options");m&&(f.plans=[{planId:m}]);try{window.$memberstackDom._showLoader();const p=a(n)?await window.$memberstackDom.signupWithProvider(f):await window.$memberstackDom.signupMemberEmailPassword(f);console.log("Signup successful:",p),g?await window.$memberstackDom.purchasePlansWithCheckout({priceId:g}):I(p.data.redirect),window.$memberstackDom._hideLoader()}catch(p){await i("Signup failed:",p),window.$memberstackDom._hideLoader()}}(k=document.querySelector('[data-ms-form="signup"]'))==null||k.addEventListener("submit",async s=>(s.preventDefault(),s.stopPropagation(),s.stopImmediatePropagation(),await r(s,"signup"),!1)),(u=document.querySelector('[data-ms-form="login"]'))==null||u.addEventListener("submit",async s=>(s.preventDefault(),s.stopPropagation(),s.stopImmediatePropagation(),await r(s,"login"),!1)),document.querySelectorAll('[data-ms-auth-provider="google"]').forEach(s=>{s.addEventListener("click",async n=>{n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation();const l=s.closest("[data-ms-form]");if(!l){console.warn("No parent form with 'data-ms-form' found.");return}l.getAttribute("data-ms-form")==="signup"?await E(l,{provider:"google"}):await d(l,{provider:"google"})})})}w(window.$memberstackDom);const v=new _,O="/default".split(",").map(a=>new RegExp(a)),C=a=>O.some(e=>e.test(a));document.addEventListener(c.GET_APP,async()=>{if(C(location.href)){console.log("Avoided verification on excluded page");return}if(console.log("getApp"),!P()){T("unauthenticated");return}try{if(await v.validateSessionStatus()===!1){await window.$memberstackDom.logout();return}T(!0)}catch(a){if(a instanceof b){(a.status===401||a.status===403)&&await window.$memberstackDom.logout({isExpired:!0});return}}},{once:!0}),document.addEventListener(c.LOGOUT,async a=>{const{detail:e}=a;if(console.log("logout"),!P()){console.log("Member is not logged in.");return}if(e!=null&&e.isExpired)await window.$memberstackDom._showMessage("Forbidden. Please login again.",!0);else try{await window.$memberstackDom._showMessage("Your session has expired. Please login again.",!0),await v.logout()}catch(t){t instanceof b&&(t.status===401||t.status===403)&&console.log("Member is already logged out from the server.")}await L(null,"/")}),document.addEventListener(c.LOGIN,async a=>{console.log("login");const e=a.detail;if(!e&&P()){console.log("Member is already logged in."),await window.$memberstackDom._showMessage("Vous êtes déjà connecté.",!0);return}try{if(function(o){return"email"in o&&"password"in o}(e)){const o=await v.login({email:e.email,password:e.password});localStorage.setItem("_ms-mid",o.data.tokens.accessToken),localStorage.setItem("_ms-mem",JSON.stringify(o.data.member)),window.location.href=o.data.redirect}else{const o=await v.loginWithProvider({loginResponse:e});window.location.href=o.data.redirect}}catch(t){if(t instanceof y){localStorage.removeItem("_ms-mid");const o="_ms-2fa-session",i=JSON.stringify({data:t.data,type:t.type});sessionStorage.setItem(o,i),I("/src/pages/2factor-challenge/");return}throw t}}),document.addEventListener(c.SIGN_UP,async a=>{const e=a.detail;await v.signup({token:e.data.tokens.accessToken})}),$()});
