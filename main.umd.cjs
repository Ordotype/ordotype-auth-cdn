(function(l){typeof define=="function"&&define.amd?define(l):l()})(function(){"use strict";var $=Object.defineProperty;var O=(l,g,b)=>g in l?$(l,g,{enumerable:!0,configurable:!0,writable:!0,value:b}):l[g]=b;var E=(l,g,b)=>O(l,typeof g!="symbol"?g+"":g,b);const l={LOGOUT:"memberstack.logout",GET_APP:"memberstack.getApp",LOGIN:"memberstack.login",VALID_SESSION:"memberstack.validSession",SIGN_UP:"memberstack.signUp"};function g(r){if(!r)throw new Error("Memberstack instance is not defined");window._msConfig||(window._msConfig={preventLogin:!0}),window.$memberstackDom=new Proxy(r,{get(e,o){const s=e[o];return typeof s=="function"?async function(...t){if(console.log(`Method ${o} called with arguments: ${JSON.stringify(t)}`),o==="logout"){const a=new CustomEvent(l.LOGOUT,{bubbles:!1,cancelable:!1,detail:t[0]});return document.dispatchEvent(a),!1}if(o==="getApp"){const a=new Event(l.GET_APP,{bubbles:!1,cancelable:!1});document.dispatchEvent(a)}if(o==="loginMemberEmailPassword"){const a=new CustomEvent(l.LOGIN,{bubbles:!1,cancelable:!1,detail:t[0]});return document.dispatchEvent(a),{data:{}}}if(o==="loginWithProvider"){const a=await s.apply(e,t),c=new CustomEvent(l.LOGIN,{bubbles:!1,cancelable:!1,detail:a});return document.dispatchEvent(c),a}if(o==="signupWithProvider"){const a=await s.apply(e,t),c=new CustomEvent(l.SIGN_UP,{bubbles:!1,cancelable:!1,detail:a});return document.dispatchEvent(c),a}if(o==="signupMemberEmailPassword"){const a=await s.apply(e,t),c=new CustomEvent(l.SIGN_UP,{bubbles:!1,cancelable:!1,detail:a});return document.dispatchEvent(c),a}return s.apply(e,t)}:s}})}function b(){const r="_ga_7T2LX34911",e=document.cookie.split("; ");for(const o of e){const[s,t]=o.split("=");if(s===r)return t}throw new Error("Device Id cookie not found")}const T="https://staging-api.ordotype.fr/v1.0.0";class S extends Error{constructor(o,s=500){super(o);E(this,"status");this.name="AuthError",this.status=s,Error.captureStackTrace&&Error.captureStackTrace(this,S)}}class k extends Error{constructor(o,s,t){super(o);E(this,"data");E(this,"type");this.name="TwoFactorRequiredError",this.data=s,this.type=t}}class I{constructor(){E(this,"headers");const e="pk_sb_e80d8429a51c2ceb0530",o=window.localStorage.getItem("ms_session_id"),s=b();this.headers={"X-Api-Key":e,"X-Session-Id":o??void 0,"X-Device-Id":s??void 0}}async request(e,o,s="GET",t=null,a={}){const c=`${T}/${o}/${e}`,u={"Content-Type":"application/json",...this.headers,...a},v={method:s,headers:u,...t&&{body:JSON.stringify(t)}};try{const m=await fetch(c,v);if(!m.ok)throw new S(m.statusText,m.status);return m.status===204||!m.body?null:await m.json()}catch(m){throw console.error("API Request Failed:",m),m}}async validateSessionStatus(){try{const e=localStorage.getItem("_ms-mid");return await this.request("validate-session-status","auth","POST",null,{Authorization:`Bearer ${e}`})}catch(e){throw console.error("Session validation failed:",e),e}}async logout(){try{const e=localStorage.getItem("_ms-mid");await this.request("logout","auth","POST",null,{Authorization:`Bearer ${e}`}),localStorage.removeItem("_ms-mid")}catch(e){throw console.error("Session logout failed:",e),e}}async signup(e){const o={...e,device:this.headers["X-Device-Id"]??"unknown"};return await this.request("signup","auth","POST",o,{})}async login(e){const o={...e,options:{includeContentGroups:!0,isWebflow:!0},device:this.headers["X-Device-Id"]??"unknown"},s=await this.request("login","auth","POST",o,{});if(_(s))throw new k("2fa required",s.data,s.type);return s}async loginWithProvider(e){const o={...e,device:this.headers["X-Device-Id"]??"unknown"},s=await this.request("validate-google-provider","auth","POST",o,{});if(_(s))throw new k("2fa required",s.data,s.type);return s}getCookie(e){const o=document.cookie.match(new RegExp(`(^| )${e}=([^;]+)`));return o?decodeURIComponent(o[2]):null}setCookie(e,o,s){const t=new Date;t.setTime(t.getTime()+s),document.cookie=`${e}=${encodeURIComponent(o)}; expires=${t.toUTCString()}; path=/`}async throttle(e,o,s){const t=this.getCookie(o),a=Date.now();if(t&&a-parseInt(t,10)<s)return console.log(`Skipping execution of ${o}: Throttled.`),null;console.log(`Executing ${o}...`);const c=await e();return this.setCookie(o,a.toString(),s),c}validateSessionStatusThrottled(){return localStorage.getItem("_ms-mid")?this.throttle(()=>this.validateSessionStatus(),"lastSessionValidation",3*60*1e3):Promise.resolve(null)}}function _(r){return"data"in r&&typeof r.data=="object"&&"type"in r}new I;function y(){return!!localStorage.getItem("_ms-mid")}function P(r){window.$memberstackDom._showLoader(),setTimeout(()=>{window.location.href=r},500)}const A=async(r,e="/")=>{await window.$memberstackDom.logout(),localStorage.removeItem("_ms-mid"),localStorage.removeItem("_ms_mem"),P(e)},D=r=>{const e=new CustomEvent(l.VALID_SESSION,{bubbles:!1,cancelable:!1,detail:{isStatusValid:r}});document.dispatchEvent(e)};function L(){var v,m;function r(n){return"provider"in n}function e(n){return"email"in n&&"password"in n}function o(n){const i={};return n.querySelectorAll("[data-ms-member]").forEach(w=>{const f=w.getAttribute("data-ms-member");f&&!["email","password","new-password","current-password"].includes(f)&&(i[f]=w.value||"")}),i}function s(n){const i=n.getAttribute("data-ms-plan")||n.getAttribute("data-ms-plan:add")||n.getAttribute("data-ms-plan:update"),d=n.getAttribute("data-ms-price:add");return{freePlan:i,paidPlan:d}}async function t(n,i){console.error(n,i),await window.$memberstackDom._showMessage((i==null?void 0:i.message)||"An error occurred",!0)}async function a(n,i){var p,h;n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation();const d=n.target,w=(p=d.querySelector('[data-ms-member="email"]'))==null?void 0:p.value,f=(h=d.querySelector('[data-ms-member="password"]'))==null?void 0:h.value;i==="signup"?await u(d,{email:w,password:f}):i==="login"&&await c(d,{email:w,password:f})}async function c(n,i){let d;if(r(i))d={provider:i.provider};else if(e(i))d={email:i.email,password:i.password};else throw new Error("Invalid form authentication options");try{const w=r(i)?await window.$memberstackDom.loginWithProvider(d):await window.$memberstackDom.loginMemberEmailPassword(d);console.log("Signin successful:",w)}catch(w){await t("Login failed:",w)}}async function u(n,i){const d=o(n),{freePlan:w,paidPlan:f}=s(n);let p={customFields:d};if(r(i))p={allowLogin:!1,provider:i.provider};else if(e(i))p={email:i.email,password:i.password};else throw new Error("Invalid form authentication options");w&&(p.plans=[{planId:w}]);try{window.$memberstackDom._showLoader();const h=r(i)?await window.$memberstackDom.signupWithProvider(p):await window.$memberstackDom.signupMemberEmailPassword(p);console.log("Signup successful:",h),f?await window.$memberstackDom.purchasePlansWithCheckout({priceId:f}):P(h.data.redirect),window.$memberstackDom._hideLoader()}catch(h){await t("Signup failed:",h),window.$memberstackDom._hideLoader()}}(v=document.querySelector('[data-ms-form="signup"]'))==null||v.addEventListener("submit",async n=>(n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation(),await a(n,"signup"),!1)),(m=document.querySelector('[data-ms-form="login"]'))==null||m.addEventListener("submit",async n=>(n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation(),await a(n,"login"),!1)),document.querySelectorAll('[data-ms-auth-provider="google"]').forEach(n=>{n.addEventListener("click",async i=>{i.preventDefault(),i.stopPropagation(),i.stopImmediatePropagation();const d=n.closest("[data-ms-form]");if(!d){console.warn("No parent form with 'data-ms-form' found.");return}d.getAttribute("data-ms-form")==="signup"?await u(d,{provider:"google"}):await c(d,{provider:"google"})})})}(function(){g(window.$memberstackDom);const e=new I,o="/default".split(",").map(t=>new RegExp(t)),s=t=>o.some(a=>a.test(t));document.addEventListener(l.GET_APP,async()=>{if(s(location.href)){console.log("Avoided verification on excluded page");return}if(console.log("getApp"),!y()){D("unauthenticated");return}try{if(await e.validateSessionStatus()===!1){await window.$memberstackDom.logout();return}D(!0)}catch(t){if(t instanceof S){(t.status===401||t.status===403)&&await window.$memberstackDom.logout({isExpired:!0});return}}},{once:!0}),document.addEventListener(l.LOGOUT,async t=>{const{detail:a}=t;if(console.log("logout"),!y()){console.log("Member is not logged in.");return}if(a!=null&&a.isExpired)await window.$memberstackDom._showMessage("Forbidden. Please login again.",!0);else try{await window.$memberstackDom._showMessage("Your session has expired. Please login again.",!0),await e.logout()}catch(c){c instanceof S&&(c.status===401||c.status===403)&&console.log("Member is already logged out from the server.")}await A(null,"/")}),document.addEventListener(l.LOGIN,async t=>{console.log("login");const a=t.detail;if(!a&&y()){console.log("Member is already logged in."),await window.$memberstackDom._showMessage("Vous êtes déjà connecté.",!0);return}try{if(function(u){return"email"in u&&"password"in u}(a)){const u=await e.login({email:a.email,password:a.password});localStorage.setItem("_ms-mid",u.data.tokens.accessToken),localStorage.setItem("_ms-mem",JSON.stringify(u.data.member)),window.location.href=u.data.redirect}else{const u=await e.loginWithProvider({loginResponse:a});window.location.href=u.data.redirect}}catch(c){if(c instanceof k){localStorage.removeItem("_ms-mid");const u="_ms-2fa-session",v=JSON.stringify({data:c.data,type:c.type});sessionStorage.setItem(u,v),P("/src/pages/2factor-challenge/");return}throw c}}),document.addEventListener(l.SIGN_UP,async t=>{const a=t.detail;await e.signup({token:a.data.tokens.accessToken})}),L()})()});
