!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";var e=Object.defineProperty,t=(t,o,a)=>((t,o,a)=>o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[o]=a)(t,"symbol"!=typeof o?o+"":o,a);const o="memberstack.logout",a="memberstack.login",n="memberstack.validSession",s="memberstack.signUp";class i extends Error{constructor(e,o=500){super(e),t(this,"status"),this.name="AuthError",this.status=o,Error.captureStackTrace&&Error.captureStackTrace(this,i)}}class r extends Error{constructor(e,o,a){super(e),t(this,"data"),t(this,"type"),this.name="TwoFactorRequiredError",this.data=o,this.type=a}}class c{constructor(){t(this,"headers");const e=window.localStorage.getItem("ms_session_id"),o=function(){const e=document.cookie.split("; ");for(const o of e){const[e,t]=o.split("=");if("_ga_7T2LX34911"===e)return t}const t=localStorage.getItem("ms_session_id");return t&&t.length>0?localStorage.getItem("ms_session_id"):(console.warn("No device id found. Using default value."),"unknown-device-id")}();this.headers={"X-Api-Key":"pk_97bbd1213f5b1bd2fc0f","X-Session-Id":e??void 0,"X-Device-Id":o??void 0}}async request(e,t,o="GET",a=null,n={},s){const r=`https://api.ordotype.fr/v1.0.0/${t}/${e}`,c={method:o,headers:{"Content-Type":"application/json",...this.headers,...n},...a&&{body:JSON.stringify(a)},signal:s};try{const e=await fetch(r,c);if(!e.ok)throw new i(e.statusText,e.status);return 204!==e.status&&e.body?await e.json():null}catch(d){if(d instanceof DOMException&&"AbortError"===d.name)return console.warn("Request was canceled:",d),null;throw console.error("API Request Failed:",d),d}}async validateSessionStatus(){const e=new AbortController;try{const t=localStorage.getItem("_ms-mid");return await this.request("validate-session-status","auth","POST",null,{Authorization:`Bearer ${t}`},e.signal)}catch(t){throw console.error("Session validation failed:",t),t}}async logout(){try{const e=localStorage.getItem("_ms-mid");await this.request("logout","auth","POST",null,{Authorization:`Bearer ${e}`}),localStorage.removeItem("_ms-mid")}catch(e){throw console.error("Session logout failed:",e),e}}async signup(e){const t={...e,device:this.headers["X-Device-Id"]??"unknown"};return await this.request("signup","auth","POST",t,{})}async login(e){const t={...e,options:{includeContentGroups:!0,isWebflow:!0},device:this.headers["X-Device-Id"]??"unknown"},o=await this.request("login","auth","POST",t,{});if(d(o))throw new r("2fa required",o.data,o.type);return o}async loginWithProvider(e){const t={...e,device:this.headers["X-Device-Id"]??"unknown"},o=await this.request("validate-google-provider","auth","POST",t,{});if(d(o))throw new r("2fa required",o.data,o.type);return o}getCookie(e){const t=document.cookie.match(new RegExp(`(^| )${e}=([^;]+)`));return t?decodeURIComponent(t[2]):null}setCookie(e,t,o){const a=new Date;a.setTime(a.getTime()+o),document.cookie=`${e}=${encodeURIComponent(t)}; expires=${a.toUTCString()}; path=/`}async throttle(e,t,o){const a=this.getCookie(t),n=Date.now();if(a&&n-parseInt(a,10)<o)return console.log(`Skipping execution of ${t}: Throttled.`),null;console.log(`Executing ${t}...`);const s=await e();return this.setCookie(t,n.toString(),o),s}validateSessionStatusThrottled(){return localStorage.getItem("_ms-mid")?this.throttle((()=>this.validateSessionStatus()),"lastSessionValidation",18e4):Promise.resolve(null)}}function d(e){return"data"in e&&"object"==typeof e.data&&"type"in e}function l(){return!!localStorage.getItem("_ms-mid")}function m(e){window.$memberstackDom._showLoader(),setTimeout((()=>{window.location.href=e}),500)}new c;const u=e=>{const t=new CustomEvent(n,{bubbles:!1,cancelable:!1,detail:{isStatusValid:e}});document.dispatchEvent(t)};function w(e){return"provider"in e}function p(e){return"email"in e&&"password"in e}async function g(e,t){console.error(e,t),await window.$memberstackDom._showMessage((null==t?void 0:t.message)||"An error occurred",!0)}async function f(e,t){var o,a;e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const n=e.target,s=null==(o=n.querySelector('[data-ms-member="email"]'))?void 0:o.value,i=null==(a=n.querySelector('[data-ms-member="password"]'))?void 0:a.value;"signup"===t?await v(n,{email:s,password:i}):"login"===t&&await h(n,{email:s,password:i})}async function h(e,t){let o;if(w(t))o={provider:t.provider};else{if(!p(t))throw new Error("Invalid form authentication options");o={email:t.email,password:t.password}}try{const e=w(t)?await window.$memberstackDom.loginWithProvider(o):await window.$memberstackDom.loginMemberEmailPassword(o);console.log("Signin successful:",e)}catch(a){await g("Login failed:",a)}}async function v(e,t){const o=function(e){const t={};return e.querySelectorAll("[data-ms-member]").forEach((e=>{const o=e.getAttribute("data-ms-member");o&&!["email","password","new-password","current-password"].includes(o)&&(t[o]=e.value||"")})),t}(e),{freePlan:a,paidPlan:n}=function(e){return{freePlan:e.getAttribute("data-ms-plan")||e.getAttribute("data-ms-plan:add")||e.getAttribute("data-ms-plan:update"),paidPlan:e.getAttribute("data-ms-price:add")}}(e);let s={customFields:o};if(w(t))s={allowLogin:!1,provider:t.provider};else{if(!p(t))throw new Error("Invalid form authentication options");s={email:t.email,password:t.password}}a&&(s.plans=[{planId:a}]);try{window.$memberstackDom._showLoader();const e=w(t)?await window.$memberstackDom.signupWithProvider(s):await window.$memberstackDom.signupMemberEmailPassword(s);console.log("Signup successful:",e),n?await window.$memberstackDom.purchasePlansWithCheckout({priceId:n}):m(e.data.redirect),window.$memberstackDom._hideLoader()}catch(i){await g("Signup failed:",i),window.$memberstackDom._hideLoader()}}function b(e){const t=e.querySelector("[data-ms-member='email']"),o=e.querySelector("[data-ms-member='password']");t&&(t.type="email"),o&&(o.type="password"),e.addEventListener("submit",(async e=>(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),await f(e,"signup"),!1)))}function y(e){const t=e.querySelector("[data-ms-member='email']"),o=e.querySelector("[data-ms-member='password']");t&&(t.type="email"),o&&(o.type="password"),e.addEventListener("submit",(async e=>(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),await f(e,"login"),!1)))}!function(e){if(!e)throw new Error("Memberstack instance is not defined");window._msConfig||(window._msConfig={preventLogin:!0}),window.$memberstackDom=new Proxy(e,{get(e,t){const n=e[t];return"function"==typeof n?async function(...i){if(console.log(`Method ${t} called with arguments: ${JSON.stringify(i)}`),"logout"===t){const e=new CustomEvent(o,{bubbles:!1,cancelable:!1,detail:i[0]});return document.dispatchEvent(e),!1}if("loginMemberEmailPassword"===t){const e=new CustomEvent(a,{bubbles:!1,cancelable:!1,detail:i[0]});return document.dispatchEvent(e),{data:{}}}if("loginWithProvider"===t){const t=await n.apply(e,i),o=new CustomEvent(a,{bubbles:!1,cancelable:!1,detail:t});return document.dispatchEvent(o),t}if("signupWithProvider"===t){const t=await n.apply(e,i),o=new CustomEvent(s,{bubbles:!1,cancelable:!1,detail:t});return document.dispatchEvent(o),t}if("signupMemberEmailPassword"===t){const t=await n.apply(e,i),o=new CustomEvent(s,{bubbles:!1,cancelable:!1,detail:t});return document.dispatchEvent(o),t}if("getMemberCookie"===t){const t=await await n.apply(e,i);return String(t).toString()}return n.apply(e,i)}:n}})}(window.$memberstackDom);const S=new c,k="/default".split(",").map((e=>new RegExp(e)));async function E(){var e;if(e=location.href,k.some((t=>t.test(e))))console.log("Avoided verification on excluded page");else if(console.log("getApp"),l())try{if(!1===await S.validateSessionStatus())return void(await window.$memberstackDom.logout());u(!0)}catch(t){if(t instanceof i)return void(401!==t.status&&403!==t.status||await window.$memberstackDom.logout({isExpired:!0}))}else u("unauthenticated")}!async function(){document.addEventListener("load",(()=>{const e=document.querySelector('[data-ordo-form="signup"]'),t=document.querySelector('[data-ms-form="signup"]');e&&b(e),t&&b(t),e||t||console.warn("no signup form found.");const o=document.querySelector('[data-ordo-form="login"]'),a=document.querySelector('[data-ms-form="login"]');o&&y(o),a&&y(a),o||a||console.warn("no login form found."),(document.querySelectorAll('[data-ordo-auth-provider="google"]')||document.querySelectorAll('[data-ms-auth-provider="google"]')).forEach((e=>{e.addEventListener("click",(async t=>{t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();const o=e.closest("[data-ordo-form]")||e.closest("[data-ms-form]");o?"signup"===o.getAttribute("data-ms-form")?await v(o,{provider:"google"}):await h(0,{provider:"google"}):console.warn("No parent form with 'data-ms-form' found.")}))})),document.querySelectorAll('[data-ordo-action="logout"]').forEach((e=>{e.addEventListener("click",(async function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),await window.$memberstackDom.logout()}))}))})),window.$memberstackReady?await E():document.addEventListener("memberstack.ready",(async()=>{await E()}))}(),document.addEventListener(o,(async e=>{const{detail:t}=e;if(console.log("logout"),l()){if(null==t?void 0:t.isExpired)await window.$memberstackDom._showMessage("Votre session a expiré. Veuillez vous reconnecter.",!0);else try{await S.logout()}catch(o){o instanceof i&&(401!==o.status&&403!==o.status||console.log("Member is already logged out from the server."))}await(async(e,t="/")=>{localStorage.removeItem("_ms-mid"),localStorage.removeItem("_ms-mem"),m(t)})(0,"/")}else console.log("Member is not logged in.")})),document.addEventListener(a,(async e=>{console.log("login");const t=e.detail;if(!t&&l())return console.log("Member is already logged in."),void(await window.$memberstackDom._showMessage("Vous êtes déjà connecté.",!0));try{if(function(e){return"email"in e&&"password"in e}(t)){const e=await S.login({email:t.email,password:t.password});localStorage.setItem("_ms-mid",e.data.tokens.accessToken),localStorage.setItem("_ms-mem",JSON.stringify(e.data.member)),window.location.href=e.data.redirect}else{const e=await S.loginWithProvider({loginResponse:t});window.location.href=e.data.redirect}}catch(o){if(o instanceof r){localStorage.removeItem("_ms-mid");const e="_ms-2fa-session",t=JSON.stringify({data:o.data,type:o.type});return sessionStorage.setItem(e,t),void m("/membership/connexion-2fa")}throw o}})),document.addEventListener(s,(async e=>{const t=e.detail;await S.signup({token:t.data.tokens.accessToken})}))}));
