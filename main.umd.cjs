(function(l){typeof define=="function"&&define.amd?define(l):l()})(function(){"use strict";var O=Object.defineProperty;var C=(l,w,h)=>w in l?O(l,w,{enumerable:!0,configurable:!0,writable:!0,value:h}):l[w]=h;var S=(l,w,h)=>C(l,typeof w!="symbol"?w+"":w,h);const l={LOGOUT:"memberstack.logout",GET_APP:"memberstack.getApp",LOGIN:"memberstack.login",VALID_SESSION:"memberstack.validSession",SIGN_UP:"memberstack.signUp"};function w(r){if(!r)throw new Error("Memberstack instance is not defined");window._msConfig||(window._msConfig={preventLogin:!0}),window.$memberstackDom=new Proxy(r,{get(t,o){const e=t[o];return typeof e=="function"?async function(...a){if(console.log(`Method ${o} called with arguments: ${JSON.stringify(a)}`),o==="logout"){const n=new CustomEvent(l.LOGOUT,{bubbles:!1,cancelable:!1,detail:a[0]});return document.dispatchEvent(n),!1}if(o==="getApp"){const n=new Event(l.GET_APP,{bubbles:!1,cancelable:!1});document.dispatchEvent(n)}if(o==="loginMemberEmailPassword"){const n=new CustomEvent(l.LOGIN,{bubbles:!1,cancelable:!1,detail:a[0]});return document.dispatchEvent(n),{data:{}}}if(o==="loginWithProvider"){const n=await e.apply(t,a),c=new CustomEvent(l.LOGIN,{bubbles:!1,cancelable:!1,detail:n});return document.dispatchEvent(c),n}if(o==="signupWithProvider"){const n=await e.apply(t,a),c=new CustomEvent(l.SIGN_UP,{bubbles:!1,cancelable:!1,detail:n});return document.dispatchEvent(c),n}if(o==="signupMemberEmailPassword"){const n=await e.apply(t,a),c=new CustomEvent(l.SIGN_UP,{bubbles:!1,cancelable:!1,detail:n});return document.dispatchEvent(c),n}return e.apply(t,a)}:e}})}function h(){const r="_ga_7T2LX34911",t=document.cookie.split("; ");for(const o of t){const[e,a]=o.split("=");if(e===r)return a}throw new Error("Device Id cookie not found")}const T="https://staging-api.ordotype.fr/v1.0.0";class v extends Error{constructor(o,e=500){super(o);S(this,"status");this.name="AuthError",this.status=e,Error.captureStackTrace&&Error.captureStackTrace(this,v)}}class k extends Error{constructor(o,e,a){super(o);S(this,"data");S(this,"type");this.name="TwoFactorRequiredError",this.data=e,this.type=a}}class I{constructor(){S(this,"headers");const t="pk_sb_e80d8429a51c2ceb0530",o=window.localStorage.getItem("ms_session_id"),e=h();this.headers={"X-Api-Key":t,"X-Session-Id":o??void 0,"X-Device-Id":e??void 0}}async request(t,o,e="GET",a=null,n={}){const c=`${T}/${o}/${t}`,b={"Content-Type":"application/json",...this.headers,...n},E={method:e,headers:b,...a&&{body:JSON.stringify(a)}};try{const u=await fetch(c,E);if(!u.ok)throw new v(u.statusText,u.status);return u.status===204||!u.body?null:await u.json()}catch(u){throw console.error("API Request Failed:",u),u}}async validateSessionStatus(){try{const t=localStorage.getItem("_ms-mid");return await this.request("validate-session-status","auth","POST",null,{Authorization:`Bearer ${t}`})}catch(t){throw console.error("Session validation failed:",t),t}}async logout(){try{const t=localStorage.getItem("_ms-mid");await this.request("logout","auth","POST",null,{Authorization:`Bearer ${t}`}),localStorage.removeItem("_ms-mid")}catch(t){throw console.error("Session logout failed:",t),t}}async signup(t){const o={...t,device:this.headers["X-Device-Id"]??"unknown"};return await this.request("signup","auth","POST",o,{})}async login(t){const o={...t,options:{includeContentGroups:!0,isWebflow:!0},device:this.headers["X-Device-Id"]??"unknown"},e=await this.request("login","auth","POST",o,{});if(_(e))throw new k("2fa required",e.data,e.type);return e}async loginWithProvider(t){const o={...t,device:this.headers["X-Device-Id"]??"unknown"},e=await this.request("validate-google-provider","auth","POST",o,{});if(_(e))throw new k("2fa required",e.data,e.type);return e}getCookie(t){const o=document.cookie.match(new RegExp(`(^| )${t}=([^;]+)`));return o?decodeURIComponent(o[2]):null}setCookie(t,o,e){const a=new Date;a.setTime(a.getTime()+e),document.cookie=`${t}=${encodeURIComponent(o)}; expires=${a.toUTCString()}; path=/`}async throttle(t,o,e){const a=this.getCookie(o),n=Date.now();if(a&&n-parseInt(a,10)<e)return console.log(`Skipping execution of ${o}: Throttled.`),null;console.log(`Executing ${o}...`);const c=await t();return this.setCookie(o,n.toString(),e),c}validateSessionStatusThrottled(){return localStorage.getItem("_ms-mid")?this.throttle(()=>this.validateSessionStatus(),"lastSessionValidation",3*60*1e3):Promise.resolve(null)}}function _(r){return"data"in r&&typeof r.data=="object"&&"type"in r}new I;function y(){return!!localStorage.getItem("_ms-mid")}function P(r){window.$memberstackDom._showLoader(),setTimeout(()=>{window.location.href=r},500)}const A=async(r,t="/")=>{await window.$memberstackDom.logout(),localStorage.removeItem("_ms-mid"),localStorage.removeItem("_ms_mem"),P(t)},D=r=>{const t=new CustomEvent(l.VALID_SESSION,{bubbles:!1,cancelable:!1,detail:{isStatusValid:r}});document.dispatchEvent(t)};function L(){var E,u;function r(s){return"provider"in s}function t(s){return"email"in s&&"password"in s}function o(s){const i={};return s.querySelectorAll("[data-ms-member]").forEach(m=>{const g=m.getAttribute("data-ms-member");g&&!["email","password","new-password","current-password"].includes(g)&&(i[g]=m.value||"")}),i}function e(s){const i=s.getAttribute("data-ms-plan")||s.getAttribute("data-ms-plan:add")||s.getAttribute("data-ms-plan:update"),d=s.getAttribute("data-ms-price:add");return{freePlan:i,paidPlan:d}}async function a(s,i){console.error(s,i),await window.$memberstackDom._showMessage((i==null?void 0:i.message)||"An error occurred",!0)}async function n(s,i){var f,p;s.preventDefault(),s.stopPropagation(),s.stopImmediatePropagation();const d=s.target,m=(f=d.querySelector('[data-ms-member="email"]'))==null?void 0:f.value,g=(p=d.querySelector('[data-ms-member="password"]'))==null?void 0:p.value;i==="signup"?await b(d,{email:m,password:g}):i==="login"&&await c(d,{email:m,password:g})}async function c(s,i){let d;if(r(i))d={provider:i.provider};else if(t(i))d={email:i.email,password:i.password};else throw new Error("Invalid form authentication options");try{const m=r(i)?await window.$memberstackDom.loginWithProvider(d):await window.$memberstackDom.loginMemberEmailPassword(d);console.log("Signin successful:",m)}catch(m){await a("Login failed:",m)}}async function b(s,i){const d=o(s),{freePlan:m,paidPlan:g}=e(s);let f={customFields:d};if(r(i))f={allowLogin:!1,provider:i.provider};else if(t(i))f={email:i.email,password:i.password};else throw new Error("Invalid form authentication options");m&&(f.plans=[{planId:m}]);try{window.$memberstackDom._showLoader();const p=r(i)?await window.$memberstackDom.signupWithProvider(f):await window.$memberstackDom.signupMemberEmailPassword(f);console.log("Signup successful:",p),g?await window.$memberstackDom.purchasePlansWithCheckout({priceId:g}):P(p.data.redirect),window.$memberstackDom._hideLoader()}catch(p){await a("Signup failed:",p),window.$memberstackDom._hideLoader()}}(E=document.querySelector('[data-ms-form="signup"]'))==null||E.addEventListener("submit",async s=>(s.preventDefault(),s.stopPropagation(),s.stopImmediatePropagation(),await n(s,"signup"),!1)),(u=document.querySelector('[data-ms-form="login"]'))==null||u.addEventListener("submit",async s=>(s.preventDefault(),s.stopPropagation(),s.stopImmediatePropagation(),await n(s,"login"),!1)),document.querySelectorAll('[data-ms-auth-provider="google"]').forEach(s=>{s.addEventListener("click",async i=>{i.preventDefault(),i.stopPropagation(),i.stopImmediatePropagation();const d=s.closest("[data-ms-form]");if(!d){console.warn("No parent form with 'data-ms-form' found.");return}d.getAttribute("data-ms-form")==="signup"?await b(d,{provider:"google"}):await c(d,{provider:"google"})})})}function $(){w(window.$memberstackDom);const r=new I,t="/default".split(",").map(e=>new RegExp(e)),o=e=>t.some(a=>a.test(e));document.addEventListener(l.GET_APP,async()=>{if(o(location.href)){console.log("Avoided verification on excluded page");return}if(console.log("getApp"),!y()){D("unauthenticated");return}try{if(await r.validateSessionStatus()===!1){await window.$memberstackDom.logout();return}D(!0)}catch(e){if(e instanceof v){(e.status===401||e.status===403)&&await window.$memberstackDom.logout({isExpired:!0});return}}},{once:!0}),document.addEventListener(l.LOGOUT,async e=>{const{detail:a}=e;if(console.log("logout"),!y()){console.log("Member is not logged in.");return}if(a!=null&&a.isExpired)await window.$memberstackDom._showMessage("Forbidden. Please login again.",!0);else try{await window.$memberstackDom._showMessage("Your session has expired. Please login again.",!0),await r.logout()}catch(n){n instanceof v&&(n.status===401||n.status===403)&&console.log("Member is already logged out from the server.")}await A(null,"/")}),document.addEventListener(l.LOGIN,async e=>{console.log("login");const a=e.detail;if(!a&&y()){console.log("Member is already logged in."),await window.$memberstackDom._showMessage("Vous êtes déjà connecté.",!0);return}try{if(function(c){return"email"in c&&"password"in c}(a)){const c=await r.login({email:a.email,password:a.password});localStorage.setItem("_ms-mid",c.data.tokens.accessToken),localStorage.setItem("_ms-mem",JSON.stringify(c.data.member)),window.location.href=c.data.redirect}else{const c=await r.loginWithProvider({loginResponse:a});window.location.href=c.data.redirect}}catch(n){if(n instanceof k){localStorage.removeItem("_ms-mid");const c="_ms-2fa-session",b=JSON.stringify({data:n.data,type:n.type});sessionStorage.setItem(c,b),P("/src/pages/2factor-challenge/");return}throw n}}),document.addEventListener(l.SIGN_UP,async e=>{const a=e.detail;await r.signup({token:a.data.tokens.accessToken})}),L()}$()});
