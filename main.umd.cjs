!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";var e=Object.defineProperty,t=(t,o,a)=>((t,o,a)=>o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[o]=a)(t,"symbol"!=typeof o?o+"":o,a);const o="memberstack.logout",a="memberstack.login",n="memberstack.validSession",s="memberstack.signUp";function i(){var e;return!0===(null==(e=window.memberstackConfig)?void 0:e.forceProd)||"www.ordotype.fr"===location.host}const r=i()?"https://api.ordotype.fr/v1.0.0":"https://staging-api.ordotype.fr/v1.0.0";class c extends Error{constructor(e,o=500){super(e),t(this,"status"),this.name="AuthError",this.status=o,Error.captureStackTrace&&Error.captureStackTrace(this,c)}}class d extends Error{constructor(e,o,a){super(e),t(this,"data"),t(this,"type"),this.name="TwoFactorRequiredError",this.data=o,this.type=a}}class l{constructor(){t(this,"headers");const e=i()?"pk_97bbd1213f5b1bd2fc0f":"pk_sb_e80d8429a51c2ceb0530",o=window.localStorage.getItem("ms_session_id"),a=function(){const e=document.cookie.split("; ");for(const o of e){const[e,t]=o.split("=");if("_ga_7T2LX34911"===e)return t}const t=localStorage.getItem("ms_session_id");return t&&t.length>0?(console.warn("No GA cookie found. Using ms session id value."),localStorage.getItem("ms_session_id")):(console.warn("No device id found. Using default value."),"unknown-device-id")}();if(!e)throw new Error("Missing API key for AuthService");this.headers={"X-Api-Key":e,"X-Session-Id":o??void 0,"X-Device-Id":a??void 0}}async request(e,t,o="GET",a=null,n={},s){const i=`${r}/${t}/${e}`,d={method:o,headers:{"Content-Type":"application/json",...this.headers,...n},...a&&{body:JSON.stringify(a)},signal:s};try{const e=await fetch(i,d);if(!e.ok){const t=await e.text();if(t){const o=JSON.parse(t);throw new c(o.message,e.status)}throw new c(e.statusText,e.status)}if(204===e.status||!e.body)return null;if(e){const t=await e.text();return t?JSON.parse(t):null}return null}catch(l){if(l instanceof DOMException&&"AbortError"===l.name)return console.warn("Request was canceled:",l),null;throw l}}async validateSessionStatus(){const e=new AbortController;try{const t=localStorage.getItem("_ms-mid");return await this.request("validate-session-status","auth","POST",null,{Authorization:`Bearer ${t}`},e.signal)}catch(t){throw console.error("Session validation failed:",t),t}}async logout(){try{const e=localStorage.getItem("_ms-mid");await this.request("logout","auth","POST",null,{Authorization:`Bearer ${e}`}),localStorage.removeItem("_ms-mid")}catch(e){throw console.error("Session logout failed:",e),e}}async signup(e){const t={...e,device:this.headers["X-Device-Id"]??"unknown"};return await this.request("signup","auth","POST",t,{})}async login(e){const t={...e,options:{includeContentGroups:!0,isWebflow:!0},device:this.headers["X-Device-Id"]??"unknown"},o=await this.request("login","auth","POST",t,{});if(m(o))throw new d("2fa required",o.data,o.type);return o}async loginWithProvider(e){const t={...e,device:this.headers["X-Device-Id"]??"unknown"},o=await this.request("validate-google-provider","auth","POST",t,{});if(o&&m(o))throw new d("2fa required",o.data,o.type);return o}getCookie(e){const t=document.cookie.match(new RegExp(`(^| )${e}=([^;]+)`));return t?decodeURIComponent(t[2]):null}setCookie(e,t,o){const a=new Date;a.setTime(a.getTime()+o),document.cookie=`${e}=${encodeURIComponent(t)}; expires=${a.toUTCString()}; path=/`}async throttle(e,t,o){const a=this.getCookie(t),n=Date.now();if(a&&n-parseInt(a,10)<o)return console.log(`Skipping execution of ${t}: Throttled.`),null;console.log(`Executing ${t}...`);const s=await e();return this.setCookie(t,n.toString(),o),s}validateSessionStatusThrottled(){return localStorage.getItem("_ms-mid")?this.throttle((()=>this.validateSessionStatus()),"lastSessionValidation",18e4):Promise.resolve(null)}}function m(e){return"data"in e&&"object"==typeof e.data&&"type"in e}function u(){const e=localStorage.getItem("_ms-mid");return console.log("isMemberLoggedIn",!!e),!!e}function w(e){window.$memberstackDom._showLoader(),console.log("navigating to: ",e),setTimeout((()=>{window.location.href=e}),700)}new l;const g=e=>{const t=new CustomEvent(n,{bubbles:!1,cancelable:!1,detail:{isStatusValid:e}});document.dispatchEvent(t)};function p(e){return"provider"in e}function f(e){return"email"in e&&"password"in e}async function h(e,t){console.error(e,t),await window.$memberstackDom._showMessage((null==t?void 0:t.message)||"An error occurred",!0)}async function b(e,t){var o,a;e.preventDefault(),e.stopImmediatePropagation();const n=e.target,s=null==(o=n.querySelector('[data-ms-member="email"]'))?void 0:o.value,i=null==(a=n.querySelector('[data-ms-member="password"]'))?void 0:a.value;"signup"===t?await y(n,{email:s,password:i}):"login"===t&&await v(n,{email:s,password:i})}async function v(e,t){let o;if(window.$memberstackDom._showLoader(),p(t))o={provider:t.provider};else{if(!f(t))throw new Error("Invalid form authentication options");o={email:t.email,password:t.password}}try{const e=p(t)?await window.$memberstackDom.loginWithProvider(o):await window.$memberstackDom.loginMemberEmailPassword(o);console.log("Signin submit finished:",e)}catch(a){window.$memberstackDom._hideLoader(),await h("Login failed:",a)}}async function y(e,t){const o=function(e){const t={};return e.querySelectorAll("[data-ms-member]").forEach((e=>{const o=e.getAttribute("data-ms-member");o&&!["email","password","new-password","current-password"].includes(o)&&(t[o]=e.value||"")})),t}(e),{freePlan:a,paidPlan:n}=function(e){return{freePlan:e.getAttribute("data-ms-plan")||e.getAttribute("data-ms-plan:add")||e.getAttribute("data-ms-plan:update"),paidPlan:e.getAttribute("data-ms-price:add")}}(e);let s={customFields:o};if(p(t))s={allowLogin:!1,provider:t.provider};else{if(!f(t))throw new Error("Invalid form authentication options");s={email:t.email,password:t.password}}a&&(s.plans=[{planId:a}]);try{window.$memberstackDom._showLoader(),p(t)?await window.$memberstackDom.signupWithProvider({...s,paidPlan:n}):await window.$memberstackDom.signupMemberEmailPassword({...s,paidPlan:n})}catch(i){await h("Signup failed:",i),window.$memberstackDom._hideLoader()}}function S(e){const t=e.querySelector("[data-ms-member='email']"),o=e.querySelector("[data-ms-member='password']");t&&(t.type="email"),o&&(o.type="password"),e.addEventListener("submit",(async e=>(e.stopImmediatePropagation(),e.preventDefault(),await b(e,"signup"),!1)),!0)}function k(e){const t=e.querySelector("[data-ms-member='email']"),o=e.querySelector("[data-ms-member='password']");t&&(t.type="email"),o&&(o.type="password"),e.addEventListener("submit",(async e=>(e.stopImmediatePropagation(),e.preventDefault(),await b(e,"login"),!1)),!0)}const _=new l,$="/challenge,/signup,/login,/successful-login".split(",").map((e=>new RegExp(e)));async function E(){var e;if(console.log("ordo auth init"),function(e){if(!e)throw new Error("Memberstack instance is not defined");window._msConfig||(window._msConfig={preventLogin:!0}),window.$memberstackDom=new Proxy(e,{get(e,t){const n=e[t];return"function"==typeof n?async function(...i){if(console.log(`Method ${t} called with arguments: ${JSON.stringify(i)}`),"logout"===t){const e=new CustomEvent(o,{bubbles:!1,cancelable:!1,detail:i[0]});return document.dispatchEvent(e),!1}if("loginMemberEmailPassword"===t){const e=new CustomEvent(a,{bubbles:!1,cancelable:!1,detail:i[0]});return document.dispatchEvent(e),{data:{}}}if("loginWithProvider"===t){let t;try{t=await n.apply(e,i)}catch(r){throw r}const o=new CustomEvent(a,{bubbles:!1,cancelable:!1,detail:t});return document.dispatchEvent(o),t}if("signupWithProvider"===t){let t;const o=i[0],{paidPlan:a,...c}=o;try{t=await n.apply(e,[c])}catch(r){throw r}const d=new CustomEvent(s,{bubbles:!1,cancelable:!1,detail:[t,a]});return document.dispatchEvent(d),t}if("signupMemberEmailPassword"===t){let t;const o=i[0],{paidPlan:a,...c}=o;try{t=await n.apply(e,[c])}catch(r){throw r}const d=new CustomEvent(s,{bubbles:!1,cancelable:!1,detail:[t,a]});return document.dispatchEvent(d),t}if("getMemberCookie"===t){const t=await await n.apply(e,i);return String(t).toString()}return n.apply(e,i)}:n}})}(window.$memberstackDom),window.Webflow=window.Webflow||[],window.Webflow.push((()=>{console.log("document loaded"),function(){const e=document.querySelector('[data-ordo-form="signup"]'),t=document.querySelector('[data-ms-form="signup"]');e&&S(e),t&&S(t),e||t||console.warn("no signup form found.");const o=document.querySelector('[data-ordo-form="login"]'),a=document.querySelector('[data-ms-form="login"]');o&&k(o),a&&k(a),o||a||console.warn("no login form found."),(document.querySelectorAll('[data-ordo-auth-provider="google"]').length?document.querySelectorAll('[data-ordo-auth-provider="google"]'):document.querySelectorAll('[data-ms-auth-provider="google"]')).forEach((e=>{e.addEventListener("click",(async t=>{t.stopImmediatePropagation(),t.preventDefault();const o=e.closest("[data-ordo-form]")||e.closest("[data-ms-form]");o?"signup"===o.getAttribute("data-ms-form")?await y(o,{provider:"google"}):await v(0,{provider:"google"}):console.warn("No parent form with 'data-ms-form' found.")}),!0)})),(document.querySelectorAll('[data-ordo-action="logout"]').length?document.querySelectorAll('[data-ordo-action="logout"]'):document.querySelectorAll('[data-ms-action="logout"]')).forEach((e=>{const t=e.cloneNode(!0);e.parentNode&&e.parentNode.replaceChild(t,e),t.addEventListener("click",(async function(e){e.stopImmediatePropagation(),e.preventDefault(),await window.$memberstackDom.logout()}),!0)}))}()})),e=location.href,$.some((t=>t.test(e))))console.log("Avoided verification on excluded page");else if(console.log("getApp verification"),u())try{const e=await _.validateSessionStatus();if(console.log("isStatusValid",e),!1===e)return void(await window.$memberstackDom.logout());g(!0)}catch(t){if(t instanceof c)return void(401!==t.status&&403!==t.status||await window.$memberstackDom.logout({isExpired:!0}))}else g("unauthenticated")}!async function(){window.$memberstackReady?await E():document.addEventListener("memberstack.ready",(async()=>{await E()}))}(),document.addEventListener(o,(async e=>{const{detail:t}=e;if(console.log("logout"),u()){if(null==t?void 0:t.isExpired)await window.$memberstackDom._showMessage("Votre session a expiré. Veuillez vous reconnecter.",!0);else try{await _.logout()}catch(o){if(o instanceof c){if(401===o.status||403===o.status)return void console.log("Member is already logged out from the server.");throw await window.$memberstackDom._showMessage("Il y a eu une erreur avec votre demande.",!0),console.error(o),o}}await(async(e,t="/")=>{localStorage.removeItem("_ms-mid"),localStorage.removeItem("_ms-mem"),w(t)})(0,"/")}else console.log("Member is not logged in.")})),document.addEventListener(a,(async e=>{console.log("start login event");const t=e.detail;if(!t&&u())return console.log("Member is already logged in."),window.$memberstackDom._hideLoader(),void(await window.$memberstackDom._showMessage("Vous êtes déjà connecté.",!0));try{if(function(e){return"email"in e&&"password"in e}(t)){const e=await _.login({email:t.email,password:t.password});localStorage.setItem("_ms-mid",e.data.tokens.accessToken),localStorage.setItem("_ms-mem",JSON.stringify(e.data.member)),w(e.data.member.loginRedirect),window.$memberstackDom._hideLoader()}else{const e=await _.loginWithProvider({loginResponse:t});if(null===e){const e=JSON.parse(localStorage.getItem("_ms-mem")||"{}");return void w(e?e.loginRedirect:"/")}w(e.data.member.loginRedirect),window.$memberstackDom._hideLoader()}}catch(o){if(o instanceof d){const e=i()?"/membership/connexion-2fa":void 0;localStorage.removeItem("_ms-mid"),localStorage.removeItem("_ms-mem"),sessionStorage.removeItem("_ms-2fa-session"),sessionStorage.removeItem("timer_timeLeft");const t="_ms-2fa-session",a=JSON.stringify({data:o.data,type:o.type});return sessionStorage.setItem(t,a),void w(e)}if(o instanceof c)return await window.$memberstackDom._showMessage(o.message,!0),void window.$memberstackDom._hideLoader();throw await window.$memberstackDom._showMessage("Il y a eu une erreur avec votre demande.",!0),console.error(o),window.$memberstackDom._hideLoader(),o}console.log("end login event")}),{capture:!0}),document.addEventListener(s,(async e=>{const[t,o]=e.detail;try{await _.signup({token:t.data.tokens.accessToken}),o?await window.$memberstackDom.purchasePlansWithCheckout({priceId:o}):w(t.data.redirect),window.$memberstackDom._hideLoader()}catch(a){if(a instanceof c)return"User already exists"===a.message?await window.$memberstackDom._showMessage("L'email fourni est déjà utilisé, cliquez sur 'Connectez-vous'",!0):await window.$memberstackDom._showMessage(a.message,!0),void window.$memberstackDom._hideLoader();throw await window.$memberstackDom._showMessage("Il y a eu une erreur avec votre demande.",!0),window.$memberstackDom._hideLoader(),console.error(a),a}}),{capture:!0})}));
